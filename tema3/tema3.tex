\newcommand{\ox}{\overline x}

\section{Fórmulas de cuadratura}
\label{sect:form-de-cuadratura}



El cálculo de una integral definida es un problema que aparece con
frecuencia, tanto en matemáticas como en otro ámbitos (ciencia,
ingeniería, economía,\dots). En concreto, dada una función
$f:[a,b]\subset\Rset\to\Rset$, se trata de aproximar numéricamente su
integral definida en $[a,b]$,
\begin{equation*}
  \int_a^b f(x)\,dx.
\end{equation*}

La necesidad de la aproximación numérica de integrales definidas
estriba en que, con frecuencia, resulta imposible (o demasiado costoso
computacionalmente) su cálculo de forma exacta. No sólo porque, en
contextos experimentales, la función podría venir dada por una tabla
de datos, sino porque la mayor parte de las funciones matemáticas no
son integrables mediante las técnicas usuales del cálculo elemental
y por tanto no resulta aplicable la regla de Barrow, $\int_a^b f(x)\,
dx=F(b)-F(a)$.

\begin{figure}
  \centering
    \includegraphics[width=0.5\linewidth]{tema3/fc-trapecio}
  \caption{Fórmula de cuadratura del trapecio}
  \label{fig:fc-trapecio}
\end{figure}
En este tema se plantearán métodos o fórmulas numéricas, llamadas
fórmulas de cuadratura, para la aproximación de $\int_a^b f(x)\,
dx$. La primera idea es la sustitución de $f(x)$ por un interpolador,
$p_n(x)$, de forma que $\int_a^bf(x)\,dx \approx \int_a^b p_n(x)\,
dx$. Esta última integral es fácil de calcular y, como veremos,
expresar como $\sum_{i=0}^n \omega_i \, f(x_i)$ (donde los coeficiente
$\omega_i$ provienen, por ejemplo, de la integración de las
funciones base de Lagrange).


% % Por tanto, las fórmulas de cuadratura para la aproximación de
% % $\int_a^b f(x)\, dx$ serán expresiones que utilizan los valores de la
% % función en un conjunto de $n+1$ \emph{nodos}, $\{x_0,x_1,\dots,x_n\}$,
% % multiplicados por $n+1$ \emph{pesos}
% % $\{\omega_0,\omega_1,\dots,\omega_n\}$:
\begin{definition}[Fórmula de cuadratura de tipo general]
  \label{def:formula-cuadratura}
  Una \resaltar{fórmula de cuadratura} (abreviadamente, f.c.) con
  $n+1$ nodos $\{x_i\}_{i=0}^n$ y pesos $\{\omega_i\}_{i=0}^n$ en
  $\Rset$ es cualquier expresión del tipo:
  \begin{align}
    \label{eq:f.cuadratura}
    I_n(f)&=\sum_{i=0}^n \omega_i \, f(x_i).
    \\
    \intertext{Al valor}
    \notag
    E_n(f) &= \big|\int_a^b f(x)\, dx - I_n(f)\big|
  \end{align}
  se le llama \resaltar{error} de la fórmula de cuadratura (o
  simplemente \resaltar{error de cuadratura} o error de integración).
  % donde $I_n(f)\in\Rset$ representa un valor aproximado de $\int_a^b
  % f(x)\,dx$ y $E_n(f)\in\Rset$ es el error que se comete en la
  % aproximación.
\end{definition}
El objetivo es hacer que el error <<sea cercano a cero>>, y en este
sentido escribiremos
\begin{equation*}
  I_n(f) \approx \int_a^b f(x)\, dx.
\end{equation*}

\begin{definition}[Orden de una fórmula de cuadratura]
  \label{def:2}
  Una fórmula de cuadratura se dirá de \resaltar{orden} $m\in\Nset$ (o
  exacta para polinomios de orden menor o igual a $m$) si verifica:
  \begin{align*}
    E_n(p)&=0 \quad \forall p\in\Pol_m[x] \text{ (polinomios
      de grado menor o igual que $m$) y}
    \\
    E_n(p)&\neq 0 \quad \text{para \emph{algún} polinomio }
    p\in\Pol_{m+1}[x] \text{ (de grado $m+1$)}.
  \end{align*}
\end{definition}
% Así, decimos que una fórmula de cuadratura de orden $m$ es exacta para
% los polinomios de orden (menor o igual a) $m$, pero no para los de
% orden $m+1$.
\begin{remark}
  \label{rk:5}
  Utilizando la linealidad con respecto a $f$ de $\int_a^bf(x)\,dx$ y
  de $I_n(f)$, es evidente que una f.c.\ es de orden $m\in\Nset$ si
  y sólo si verifica las siguientes condiciones:
  \begin{align*}
    E_n(x^k)&=0, \quad \forall k=0\dots,m,
    \\
    E_n(x^{m+1})&\neq 0.
  \end{align*}
  En la práctica, esta suele ser la forma de estudiar el orden de
  fórmulas de cuadratura.
\end{remark}

\begin{example}
  \label{ex:formula-punto-medio}
  La siguiente fórmula de cuadratura de un punto ($n=0$) es conocida
  como \resaltar{fórmula del punto medio},
  \begin{equation}
    \label{eq:f.c.-pto-medio}
    I_0(f)= (b-a) f\left(\frac{a+b}{2}\right),
  \end{equation}
  y tiene orden $1$. En efecto, evaluando $E_0(x^k)=\int_a^b
  x^k\, dx-I_0(x^k)$ para $k\ge 0$:
  \begin{align*}
   \text{Para } k&=0:\ E_0(1) = \int_a^b 1\cdot dx - (b-a)\cdot 1 = 0.
   \\
   \text{Para } k&=1:\ E_0(x) = \int_a^b x\cdot dx - (b-a)\frac{a+b}{2}
   = \frac{1}{2}(b^2-a^2) -  (b-a) \frac{a+b}{2} = 0.
   \\
   \text{Para } k&=2:\ E_0(x^2) = \int_a^b x^2\cdot dx
   - (b-a) \frac{(a+b)^2}{4}
   = \frac{1}{3}(b^3-a^3) - (b-a)\frac{(a+b)^2}{4}
   \neq 0.
  \end{align*}
\end{example}

\begin{example}
  \label{ex:formula-trapecio}
  La siguiente f.c.\ de dos puntos ($n=1$) es conocida
  como \resaltar{fórmula del trapecio}:
  \begin{equation*}
    I_1(f)= \frac{b-a}{2}\left(f(a)+f(b)\right).
  \end{equation*}
  La formula del trapecio es de orden 1:
  \begin{align*}
    \text{Para } k&=0:\ E_1(1) = (b-a) - \frac{b-a}2\cdot 2 = 0.
    \\
    \text{Para } k&=1:\ E_1(x) = \frac{b^2-a^2}{2} -
    \frac{(b-a)}{2}(a+b) = 0.
    \\
    \text{Para } k&=2:\ E_1(x^2) = \frac{b^3-a^3}{3} -
    \frac{(b-a)}{2}(a^2+b^2) \neq 0.
  \end{align*}
\end{example}

\begin{example}
  \label{ex:formula-simpson}
  La \resaltar{fórmula de Simpson} es la siguiente f.c.\
  de tres puntos ($n=2$):
  \begin{equation}
    I_2(f)= \frac{b-a}{6}\left[f(a)+4f
      \left(\frac{a+b}{2}\right)+f(b)\right].
    \label{eq:formula-simpson}
  \end{equation}
  Su orden es $3$. La demostración es similar a los ejemplos anteriores y se deja como ejercicio.
\end{example}

\section{Fórmulas de cuadratura de tipo interpolatorio}
\label{sec:cuadratura-interpolatorio}

La expresión~(\ref{eq:f.cuadratura}) define a una fórmula de
cuadratura de tipo general, para pesos $\omega_i$ y nodos $x_i$
cualesquiera, no necesariamente provenientes de la interpolación.
Pero por motivos que veremos luego
(proposición~\ref{pro:existencia.fcti}), nos interesarán especialmente
aquellas fórmulas de cuadratura que vengan dadas por integración de un
polinomio de interpolación.
\begin{definition}[Fórmula de cuadratura de tipo interpolatorio]
  Sea $f\in C^0([a,b])$ y sea $p_n$ el polinomio de interpolación de
  Lagrange asociado a $f$ y a $n+1$ nodos
  $\{x_0,x_1,\dots,x_n\}$. Diremos que una f.c.\ es de tipo
  interpolatorio si
  \begin{equation}
    \label{eq:fcti}
    I_n(f)=\int_a^b p_n(x)\, dx.
  \end{equation}
  \label{def:fcti}
\end{definition}

La expresión~(\ref{eq:fcti}) se puede escribir de la
forma~(\ref{eq:f.cuadratura}), es decir como suma de $f(x_i)$ por
cierto pesos. En efecto, dada $f\in C^0([a,b])$,
usando la fórmula de interpolación de Lagrange tenemos:
\begin{equation*}
  p_n(x)=\sum_{i=0}^n f(x_i) L_i(x),
\end{equation*}
donde $\{L_i\}_{i=0}^n$ es la base de Lagrange asociada a
$\{x_i\}_{i=0}^n$. Por lo tanto,
\begin{equation*}
  \int_a^bp_n(x)\,dx = \sum_{i=0}^n f(x_i) \int_a^b L_i(x)\,dx
  =\sum_{i=0}^n \omega_i f(x_i), \quad \text{con } \omega_i=\int_a^b L_i(x)\,dx.
\end{equation*}

\begin{example}
  \label{ex:formula-pto-medio-interpol}
  La f.c.\ del punto medio~(\ref{eq:f.c.-pto-medio}) es de tipo
  interpolatorio. En efecto, si $p_0(x)$ es el polinomio de
  interpolación de grado cero asociado a $f$ en $x_0=(a+b)/2$, es
  decir $p_0(x)=f(x_0)$ para todo $x\in[a,b]$, entonces:
  \begin{equation*}
    I_0(f) = (b-a)f\left(\frac{a+b}{2}\right) = \int_a^b p_0(x)\,dx.
  \end{equation*}
\end{example}

\begin{example}
  \label{ex:formula-trapecio-interpol}
  Fijamos $n=1$, $x_0=a$ y $x_1=b$. Buscamos coeficientes, $\omega_0$
  y $\omega_1$ tales que la siguiente fórmula de cuadratura sea de
  tipo interpolatorio:
  \begin{equation*}
    I_1(f)=\omega_0 f(x_0) + \omega_1 f(x_1).
  \end{equation*}
  Según la definición~\ref{def:fcti}, esto significa que
  \begin{equation*}
    I_1(f)=\int_a^b p_n(x)=
    \underbrace{\left(\int_a^bL_0(x)\right)}_{\omega_0} f(x_0)+
    \underbrace{\left(\int_a^bL_1(x)\right)}_{\omega_1} f(x_1).
  \end{equation*}
  Como
  \begin{equation*}
    L_0(x)=\frac{x-x_1}{x_0-x_1}=\frac{x-b}{a-b} \quad \text{y} \quad
    L_1(x)=\frac{x-x_0}{x_1-x_0}=\frac{x-a}{b-a},
  \end{equation*}
  entonces
  \begin{equation*}
    \omega_0 = \int_a^b \frac{x-b}{a-b} = \frac{-(a-b)^2}{2(a-b)}=\frac{b-a}{2},
    \quad
    \omega_1 = \int_a^b \frac{x-a}{b-a} = \frac{(b-a)^2}{2(b-a)}=\frac{b-a}{2}.
  \end{equation*}
  Es decir, que la fórmula de cuadratura que buscamos es la
  fórmula del trapecio:
  \begin{equation*}
    I_1(f)=\frac{b-a}{2}
    \left(
      f(a)+f(b)
    \right).
  \end{equation*}
\end{example}

\begin{example}
  La fórmula de Simpson~(\ref{eq:formula-simpson}) es de tipo
  interpolatorio. La demostración se deja como ejercicio.
\end{example}

La siguiente proposición afirma que las f.c.t.i.\ son óptimas, en el
sentido de que, fijado un soporte de integración, éstas son las f.c.
de mayor orden.
\begin{proposition}
  \label{pro:existencia.fcti}
  Dados $n+1$ nodos distintos, $x_0<x_1<\cdots<x_n$:
  \begin{enumerate}
  \item Sobre estos nodos existe una única f.c.\ con orden $\ge
    n$.
  \item Esta f.c.\ coincide con la f.c.t.i.\ correspondiente a
    $\{x_i\}_{i=0}^n$.
  \end{enumerate}
\end{proposition}
\begin{proof}~\par
  \punto{1} Sea $I_n(f)=\sum_{i=0}^n \omega_i f(x_i)$ una
  f.c.\ cualquiera sobre $\{x_i\}_{i=0}^n$. $I_n(f)$ tiene orden $\ge
  n$ si y solo si $E(x^k)=0$ para $k=0,\dots,n$. Escribiendo estas $n+1$
  ecuaciones,
  \begin{equation}
    \left.
  \begin{alignedat}{2} % 2 bloques de columnas rl
    E(1)&=0 \quad \Leftrightarrow\ \quad &
    \omega_0 + \omega_1 + \cdots \omega_n &=
    \int_a^b 1\cdot\,dx = b-a
    \\
    E(x)&=0 \quad \Leftrightarrow\ \quad &
    \omega_0 x_0 + \omega_1 x_1 + \cdots \omega_n x_n &=
    \int_a^b x \cdot\,dx = \frac{b^2-a^2}{2}
    \\
    &\ \, \vdots & &\ \, \vdots
    \\
    E(x^n)&=0 \quad \Leftrightarrow\ \quad &
    \omega_0 x_0^n + \omega_1 x_1^n + \cdots \omega_n x_n^n &=
    \int_a^b x^n \cdot\,dx = \frac{b^{n+1}-a^{n+1}}{n+1}
    \\
  \end{alignedat}
  \right\}
  \label{eq:sl.fcti}
\end{equation}
  tenemos un sistema lineal con $n+1$ incógnitas
  $\{\omega_i\}_{i=0}^n$. La matriz asociada, es la conocida matriz de
  Vandermonde,
  \begin{equation*}
    A =
    \begin{pmatrix}
      1 & x_0& \cdots & x_0^n \\
      1 & x_1& \cdots & x_1^n \\
      \vdots & \vdots & & \vdots \\
      1 & x_n& \cdots & x_n^n
    \end{pmatrix}
  \end{equation*}
  (que fue estudiada en la demostración del teorema de existencia y
  unicidad el polinomio de interpolación de Lagrange), que $A$ no es
  singular si los nodos son distintos entre sí.  Por lo tanto, existe
  una única solución, $\{\omega_i\}_{i=0}^n$, que determina la única
  f.c.\ $I_n(f)$ de orden $\ge n$.

  \punto{2} Veamos que esta única f.c.\ de orden $\ge n$ coincide con
  la f.c.t.i.\ correspondiente. Por unicidad, basta
  comprobar que la f.c.t.i.\ definida sobre nodos $\{x_i\}_{i=0}^n$
  tiene orden al menos $n$, es decir verifica $E_n(p)=0$ para todo
  polinomio $p$ de grado $n$.

  Pero esto es evidente: $p(x)$ es un polinomio de grado $\le n$,
  entonces su polinomio de interpolación de Lagrange es $p_n(x)=p(x)$
  (por unicidad).  Y por ser la fórmula de tipo interpolatorio,
  $I_n(p)=\int_a^b p(x)\,dx$, luego
  $$E_n(p)=\int_a^b p(x)\,dx - \int_a^b p_n(x)\,dx =0.$$
\end{proof}

\begin{remark}
  \label{rk:6}
  La demostración de la proposición anterior nos proporciona una forma
  de calcular los pesos de cualquier f.c.t.i.: resolver el sistema
lineal~(\ref{eq:sl.fcti}). Este método se conoce como \resaltar{método de
  los coeficientes indeterminados}. Tiene el inconveniente de que su
matriz asociada, la matriz de Vandermonde, está mal condicionada
  cuando $n\to\infty$.
\end{remark}

\begin{example}
  \label{ex:coef-indetermin:formula-trapecios-abierta}
  Utilizaremos el método de los coeficientes indeterminados para
  calcular los pesos de la f.c.t.i.\ en $[a,b]$ para los nodos
  $x_0=a+h$ y $x_1=a+2h$, con $h=\frac{b-a}{3}$.

  Para $n=1$, obtenemos el siguiente sistema:
  \begin{align*}
    \omega_0 + \omega_1 &= b-a,
    \\
    x_0\omega_0 + x_1\omega_1 &= \frac{b^2-a^2}{2},
  \end{align*}
  cuya única solución es:
  \begin{equation*}
    \omega_0=\omega_1=\frac{3h}{2}.
  \end{equation*}
  Esto se puede comprobar (se deja como ejercicio) usando
  que $b-a=3h$ y $b^2-a^2 = (a+b)(b-a)=2a + 6h$.
  Así obtenemos la siguiente fórmula de cuadratura (que es conocida
  como \textit{fórmula de los trapecios abierta}:
  \begin{equation*}
    I_1(f)=\frac{3h}{2}
    \big(
      f(x_0)+f(x_1)
    \big),
  \end{equation*}
  con $x_0=a+h, \ x_1=a+2h$ para $h=\frac{b-a}{3}$.
\end{example}

\subsection*{Cota del error en fórmulas de tipo interpolatorio}

Sea $I_n(f)$ una f.c.t.i.\ sobre $n+1$ puntos y sea $p_n$ el polinomio
de Lagrange asociado.  Utilizando la expresión de error de
interpolación del polinomio de Lagrange podemos razonar como sigue:

\begin{align*}
  E_n(f)=&\int_a^b f(x)\, dx - I_n(f) =
           \int_a^b\left(f(x)-p_n(x)\right)\,dx
  \\
  =&\int_a^b \frac{f^{n+1)}(\xi_x)}{(n+1)!} (x-x_0)(x-x_1)\dots(x-x_n) \,dx
     \le \int_a^b  \frac{M_{n+1}}{(n+1)!} (b-a)^{n+1} \, dx,
\end{align*}
donde $M_{n+1}=\max_{x\in [a,b]} |f^{n+1)}(x)|$.
Por lo tanto toda f.c.t.i con $n+1$ puntos en un intervalo $[a,b]$
verifica la siguiente cota del error:
\begin{equation}
  E_n(f) \le  \frac{M_{n+1}}{(n+1)!} (b-a)^{n+2}.
  \label{eq:cota-error-fcti}
\end{equation}

Ahora nos podemos preguntar: dada una f.c.t.i., para una función $f$
suficientemente regular (por ejemplo infinitamente derivable),
¿podemos garantizar que $E_n(f)$ tiende a cero cuando $n\to\infty$?,
es decir,
\begin{eqnarray*}
  \text{\large ¿ \;}
  \lim_{n\to\infty} \int_a^b p_n(x) = \int_a^bf(x)
  \text{\; \large?}
  \label{eq:pregunta.p_n.to.f}
\end{eqnarray*}
Una vez más, la respuesta a esta pregunta es negativa en general, como
sugiere el hecho de que en la estimación~(\ref{eq:cota-error-fcti}) no
resulta posible acotar el término $M_{n+1}$, para cualquier función
infinitamente derivable, cuando $n\to\infty$.

Sin embargo, si denotamos el tamaño del intervalo como $h=(b-a)$ en la
acotación~(\ref{eq:cota-error-fcti}), podemos ver que $E_n(f)$
converge a cero cuando $h\to 0$. De hecho, (\ref{eq:cota-error-fcti})
nos indica cuál es exactamente la velocidad de convergencia:
% $g(h)=O(h^m)$ para expresar que
\begin{align}
  \notag
  E_n(f)&=O(h^{n+2}),
  %
          \intertext{donde estamos usando la notación, para toda función $g(x)$,}
          \label{eq:def.O(hm)}
          %
          \ g(h)=O(h^m) \quad&\Longleftrightarrow\quad\lim_{h\to 0} \frac{g(h)}{h^m}=C
                               \qquad \text{($C\in \Rset$ constante)}.
\end{align}

Por este motivo, en la práctica se suelen utilizar f.c.\ compuestas, en
las que dividimos $[a,b]$ en subintervalos de integración de modo que
$h\to 0$.

\section{Fórmulas de Newton-Côtes}
\label{sec:formulas-de-newton}

\begin{definition}
  \label{def:1}
  Se denomina fórmula de cuadratura de Newton-Côtes (abreviadamente
  N-C) a toda aquella f.c.t.i cuyos nodos se encuentran
  uniformemente espaciados (es decir, $x_{i}-x_{i-1}=h$ para todo
  $i=1,\dots,n$, para $h\in\Rset$ dado). Distinguimos dos tipos:
  \begin{itemize}
  \item Fórmulas cerradas: aquellas en las que
    \begin{align*}
      &h=\frac{b-a}{n}, \\
      &x_0=a, \quad x_n=b, \quad x_i=x_0 + i h.
    \end{align*}
  \item Fórmulas abiertas: aquellas en las que
    \begin{align*}
      &h=\frac{b-a}{n+2}, \\
      &x_0=a+h, \quad x_n=b- h, \quad x_i=x_0 + i h.
    \end{align*}
  \end{itemize}
\end{definition}

\begin{theorem}
  \label{thm:error.formulas-nc}
  Sea $I_n$ una f.c.t.i.\ sobre $n+1$ puntos equiespaciados en
  $[a,b]$. Supongamos que $f\in C^k([a,b])$, donde $k=n+2$ si $n$ es par
  y $k=n+1$ si $n$ es impar. Entonces, existe $\xi\in(a,b)$ tal que
  \begin{equation}
    \label{eq:error-formulas-nc}
    E_n(f)=\int_a^bf(x)\,dx - I_n(f)
    = \gamma_n \frac{h^{k+1}}{k!}f^{k)}(\xi).
  \end{equation}
  Los coeficientes $h$ y $\gamma_n$ están definidos como:
  \begin{itemize}
  \item Si $I_n$ es una fórmula cerrada: $h=(b-a)/n$ y
    \begin{align*}
      \text{ si $n$ es par }
      \gamma_n=\int_0^n t \Pi_n(t) dt,
      \quad \text{si $n$ es impar }
      \gamma_n=\int_0^n \Pi_n(t) dt.
    \end{align*}
  \item Si $I_n$ es una fórmula abierta: $h=(b-a)/(n+2)$ y
    \begin{align*}
      \text{si $n$ es par }
      \gamma_n=\int_{-1}^{n+1} t \Pi_n(t) dt,
      \quad \text{si $n$ es impar }
      \gamma_n=\int_{-1}^{n+1} \Pi_n(t) dt.
    \end{align*}
  \end{itemize}
  En lo anterior se ha usado la notación:
  $\Pi_n(t)=(t)=t(t-1)(t-2)\cdots (t-n)$.
\end{theorem}

La demostración puede encontrarse en la
bibliografía (véase [Isaacson \& Keller]).%   En adelante, escribiremos
% $h$ en vez de $\widehat h$ siempre y cuando no haya posibilidad de
% confusión.

\begin{remark}~
  \label{rk:7}
  \begin{enumerate}
  \item Las constantes $\gamma_n$ no dependen del intervalo $[a,b]$ ni
    de $f$, de forma que pueden calcularse una sola vez para
    utilizarse cuando sea necesario.
  \item Utilizando la expresión del error~(\ref{eq:error-formulas-nc})
    podemos deducir\footnote{Según~(\ref{eq:error-formulas-nc}), el
      error de una fórmula de Newton-Côtes es cero para polinomios de
      grado $i\le k-1$, pues $f^{k)}\equiv 0$ siempre que
      $f\in\Pol_{i}[x]$ con $i\le k-1$.} que las fórmulas de
    Newton-Côtes tienen orden $k-1$. Por tanto:
    \begin{enumerate}
    \item Si $n$ es \textit{impar}, las fórmulas de N--C son de
      orden $k-1 = n$.
    \item Si $n$ es \textit{par}, las fórmulas de N--C son de
      orden $k-1 = n+1$ (un grado superior a lo esperado).
    \end{enumerate}
  % \item Fijado un número de puntos, las fórmulas de N-C abiertas y
  %   cerradas tienen el mismo orden, pues aparece el mismo grado de
  %   derivación en la expresión de
  %   error~(\ref{eq:error-formulas-nc}). Pero no hay que olvidar que el
  %   valor de $h$ difiere entre fórmulas abiertas y cerradas. Así:
  %   \begin{itemize}
  %   \item Fijado un número de puntos, $n+1$, en un intervalo,
  %     $[a,b]$, el paso $h$ será más pequeño en las fórmulas de N-C
  %     abiertas, lo que supone una ventaja (aunque las constantes
  %     $\gamma_n$ pueden ser mayores en valor absoluto).
  %   \item Sin embargo, si en vez del número de puntos fijamos un paso
  %     $h$ en un intervalo de integración $[a,b]$, la fórmula de N-C
  %     cerrada contendrá un número mayor de puntos (los dos extremos
  %     del intervalo) y por tanto será exacta para polinomios de mayor
  %     orden. Por ejemplo, si fijamos $h=(b-a)/2$, Entonces:
  %     \begin{enumerate}
  %     \item La fórmula cerrada contiene los puntos $x_0=a$, $x_1=a+h$,
  %       $x_2=b$. Así $n=2$ (de hecho ésta es la fórmula de Simpson, de
  %       orden $3$).
  %     \item La fórmula abierta contiene solamente el punto $x_0=a+h$.
  %       Así $n=0$ (fórmula del punto medio, de orden $1$).
  %    \end{enumerate}
  % \end{itemize}

    % Fijemos un paso $h=(b-a)/p$, con cierto $p\in\Nset$. Entonces éste
    % se corresponde con una fórmula cerrada de $n=p+1$ puntos o con una
    % fórmula abierta de $n=p-1$ puntos. Así, en la expresión del error:
    % \begin{enumerate}
    % \item En las fórmulas \emph{abiertas}:\par
    %   \begin{tabular}{rl}
    %     Si $p$ es par, entonces $n$ es impar y: &$k=n+1=p$
    %     \\
    %     Si $p$ es impar, entonces $n$ es par y: &$k=n+2=p+1$
    %   \end{tabular}
    % \item En las fórmulas \emph{cerradas}:\par
    %   \begin{tabular}{rl}
    %     Si $p$ es par, entonces $n$ es impar y: &$k=n+1=p+2$
    %     \\
    %     Si $p$ es impar, entonces $n$ es par y: &$k=n+2=p+3$
    %   \end{tabular}
    % \end{enumerate}
    % Como conclusión: fijado un mismo paso $h$, en todos los casos
    % \emph{el orden de las fórmulas cerradas es superior en dos
    % unidades al de las fórmulas abiertas}.
  \end{enumerate}
\end{remark}
\begin{example}[Fórmulas de cuadratura cerradas]
  \label{ex:fc-NC-cerradas}
  Consideremos $n+1$ puntos en un intervalo cualquiera,
  $[a,b]=[x_{0},x_{n}]$ y $f_k=f(x_k)$, $k=0,\dots,n$. Un simple
  cálculo nos permite calcular los pesos de la f.c.\ (bien sea mediante
  integración de las funciones base de Lagrange, como en los
  ejemplos~\ref{ex:formula-pto-medio-interpol}
  y~\ref{ex:formula-trapecio-interpol} o bien usando el método de los
  coeficiente indeterminados, como en el
  ejemplo~\ref{ex:coef-indetermin:formula-trapecios-abierta}) y las
  constantes $\gamma_n$ anteriores para $n=1,2,3,\dots$.

  Por ejemplo, para $n=1$, tendremos $[a,b]=[x_0,x_1]$. La f.c.t.i
  asociada es la fórmula de los trapecios (ver
  ejemplo~\ref{ex:formula-trapecio-interpol}):
  \begin{equation*}
    I_1(f) = \frac{b-a}{2}(f(a)+f(b))
    = \frac{h}{2}(f_0+f_1),
  \end{equation*}
  donde denotamos $f_0=f(x_0)$ y $f_1=f(x_1)$. Como $n$ es impar, $k=n+1=2$ y la expresión
  del error~(\ref{eq:error-formulas-nc}) se escribe como
  \begin{equation*}
    E_1(f)=\gamma_1 h^{3}\frac{f^{2)}(\xi)}{2}=\frac{-h^3}{12} f^{2)}(\xi),
  \end{equation*}
  donde se ha usado la definición de $\gamma_1$ para fórmulas cerradas
  y $n$ impar:
  \begin{equation*}
    \gamma_1 = \int_0^1 \Pi_1(t)\,dt = \int_0^1 t(t-1) = \frac{-1}{6}.
  \end{equation*}

  Despejando $\int_a^b f(x)\,dx$ en~(\ref{eq:error-formulas-nc}) se
  puede condensar lo anterior en:
  \begin{equation*}
    \int_a^b f(x)\,dx = \int_{x_0}^{x_1} f(x)\,dx =
    \frac{h}{2}(f_0+f_1) - \frac{h^3}{12} f^{2)}(\xi).
  \end{equation*}

  Procediendo análogamente para $n=2,3,4,5$, se tiene las
  siguiente tabla de fórmulas de cuadratura de N--C cerradas:
  \begin{center}
    \includegraphics[width=0.95\linewidth]{tema3/formulas-nc-cerradas}
  \end{center}
\end{example}

\begin{example}[Fórmulas de cuadratura abiertas]
  \label{ex:fc-NC-abiertas}
  Sean $x_0,x_1,\cdots,x_n$ los $n+1$ puntos interiores al intervalo
  $[a,b]$ en una f.c.\ de N--C abierta. Denotemos ahora $x_{-1}=a$,
  $x_{n+1}=b$ y $f_k=f(x_k)$, $k=0,\dots,n$. Procediendo como antes
  se tienen las siguientes fórmulas junto con las expresiones de error
  asociadas:
  \begin{center}
    \includegraphics[width=0.95\linewidth]{tema3/formulas-nc-abiertas}
  \end{center}
  Se recomienda, como ejercicio, comprobar estas fórmulas para algunos
  valores de $n$.
\end{example}

\section{Fórmulas de cuadratura compuestas}
\label{sec:fc-compuestas}

Como hemos visto al analizar el error en fórmulas de tipo
interpolatorio, no siempre podemos asegurar que, cuando $n\to\infty$,
la aproximación $I_n(f)$ converja hacia la integral de $f$. Por esta
razón, en la práctica se usan fórmulas de cuadratura compuestas (o
integración a trozos), procediendo de la siguiente forma:
\begin{enumerate}
\item Toamos una partición del intervalo $[a,b]$,
  $a=\ox_0<\ox_1<\dots<\ox_N=b$, que por simplicidad supondremos
  uniforme (con $N+1$ puntos equiespaciados). Denotaremos
  $$
  H=\frac{\ox_{i}-\ox_{i-1}}N
  $$
  al tamaño constante de los subintervalos $[\ox_{i-1},\ox_i]$, $i=1,\dots N$.
\item Descomponemos la integral global de $f$ como suma de integrales
  en cada subintervalo:
  \begin{equation*}
    \int_a^b f(x)\,dx = \sum_{i=1}^N \int_{\ox_{i-1}}^{\ox_i}f(x)\,dx.
  \end{equation*}
\item Aplicamos, en cada subintervalo $[\ox_{i-1},\ox_i]$,
  $i=1,\dots N$, una fórmula de cuadratura sobre $n+1$ puntos, con
  $n\in\Nset$ fijo (en la práctica se suelen usar fórmulas sencillas,
  en concreto fórmulas de N--C con $n=0$, $1$ o $2$).
\end{enumerate}
Con más detalle, el último punto consiste en elegir, en cada
subintervalo $[\ox_{i-1},\ox_i]$, $n+1$ puntos equiespaciados,
$x_0^{(i)}<x_1^{(i)}<\cdots<x_n^{(i)}$ para aproximar
$\int_{\ox_{i-1}}^{\ox_i}f(x)\,dx$ por la f.c
\begin{equation}
  \label{eq:fc.compuesta.en.un.intervalo}
  I_n^{(i)}(f)=\sum_{j=0}^n \omega_j f(x_j^{(i)}).
\end{equation}
\begin{definition}
  Una fórmula de cuadratura compuesta se define como la suma de las
  f.c.\ en cada uno de los subintervalos de integración:
  \begin{equation}
    I_N(f)=\sum_{i=1}^N I_n^{(i)}(f)  =\sum_{i=1}^N \sum_{j=0}^n \omega_j f(x_j^{(i)}).
  \label{eq:fc.compuesta}
  \end{equation}
  \label{def:fc.compuesta}
\end{definition}

Para cada f.c.\ compuesta, la expresión~(\ref{eq:fc.compuesta}) suele
desarrollarse con el fin de obtener una expresión más compacta
(eliminando el doble sumatorio anterior) y a la vez alcanzar una
expresión global del error de cuadratura basada en la suma de los
errores locales (en los subintervalos $[\ox_{i-1},\ox_i]$). Para esto
último, se pueden utilizar las expresiones del error para fórmulas de
Newton-Côtes dadas en los ejemplos~\ref{ex:fc-NC-cerradas}
y~\ref{ex:fc-NC-abiertas}, siempre y cuando reescribamos la f.c.\
compuesta~(\ref{eq:fc.compuesta}) en función del parámetro $h$
introducido en la definición~\ref{def:1}, que ahora vendrá dado por
$h=(\ox_i-\ox_{i-1})/n$ y $h=(\ox_i-\ox_{i-1})/(n+2)$ en fórmulas de
Newton-Côtes cerradas y abiertas, respectivamente.



\begin{example}[Fórmula compuesta del punto medio]
  \label{ex:fc.compuesta.ptomedio}
  Consideramos la fórmula compuesta definida, en cada subintervalo
  $[\ox_{i-1},\ox_i]$, por la fórmula del punto medio (fórmula de
  N.C. abierta para $n=0$):
  \begin{equation}
    \label{eq:fc.ptomedio.local}
    \int_{\ox_{i-1}}^{\ox_{i}} f(x)\, dx \approx I_0(f)=
    (\ox_{i}-\ox_{i-1}) \, f\big(\frac{\ox_{i}+\ox_{i-1}} 2 \big), \quad i=1,\dots,N.
  \end{equation}
  Intentaremos obtener una representación explícita de esta f.c.\
  compuesta. Para ello, calculamos $h$ en función de $N$ (usando que
  $\ox_{i}-\ox_{i-1} = (b-a)/N$):
  $$
  h= \frac{\ox_{i}-\ox_{i-1}}2 = \frac{b-a}{2N}.
  $$
  Seguidamente, definimos una partición global $\{x_k\}_{k=0}^{2N}$
  que englobe a todos los puntos que aparecen en la f.c.\
  local~(\ref{eq:fc.ptomedio.local}), tomando:
  \begin{equation*}
    \left\{
      \begin{aligned}
        x_{2i} &= \ox_i, \quad i=0,\dots,N \quad \text{(extremos de los
          intervalos)},
        \\
        x_{2i-1} &= \ox_i-h \quad i=1,\dots,N
        \quad\text{(puntos medios)}.
      \end{aligned}
      \right.
    \end{equation*}
    Teniendo en cuenta que los puntos medios, $x_{2i-1}$, son los
    nodos de integración y denotando $f_{2i-1}=f(x_{2i-1})$, para cada
    $i=1,\dots,N$, podemos escribir~(\ref{eq:fc.ptomedio.local})
    utilizando sólo $h$ y los puntos de la partición
    $\{x_k\}_{k=0}^{2N}$:
  \begin{equation*}
%    \int_{\ox_{i-1}}^{\ox_{i}} f(x)\, dx =
    \int_{x_{2i-2}}^{x_{2i}} f(x)\, dx =
    2hf_{2i-1} +
    \frac{h^3}{3}f^{''}(\xi_i),
  \end{equation*}
  donde el último sumando expresa el error para la f.c.\ del punto
  medio (véase el ejemplo~\ref{ex:fc-NC-abiertas}) y
  $\xi_i\in(x_{2i-2},x_{2i})$. En consecuencia:
  \begin{equation}
   \label{eq:2}
    \int_a^b f(x)\,dx = \sum_{i=1}^{N} \int_{x_{2i-2}}^{x_{2i}} f(x)\,dx
    = 2h \sum_{i=1}^{N} f_{2i-1} + \frac{h^3}{3} \sum_{i=1}^{N}f''(\xi_i).
  \end{equation}
  Para terminar, agruparemos los términos de error en un único
  sumando. Para ello, sean $m_2=\min_{x\in[a,b]} f^{''}(x)$ y
  $M_2=\max_{x\in[a,b]} f^{''}(x)$. Como para todo $\xi_i$
  se tiene que $m_2\le f^{''}(\xi_i)\le M_2$, deducimos que
  $$
  m_2 \le \frac 1N \sum_{i=1}^Nf^{''}(\xi_i) \le M_2.
  $$
  Suponiendo que $f\in C^2([a,b])$, entonces $f''\in C([a,b])$
  alcanza todos los valores comprendidos entre su mínimo, $m_2$,
  y su máximo, $M_2$. En particular, existe $\xi\in[a,b]$ tal que
  $$
  f''(\xi) = \frac 1N \sum_{i=1}^Nf^{''}(\xi_i).
  $$
  Por tanto, el último sumando en~(\ref{eq:2}) se escribe como:
  \begin{align*}
  \frac{h^3}{3} \sum_{i=0}^{N-1}f''(\xi_i) &= \frac{h^3}{3} N \left( \frac 1N
  \sum_{i=1}^Nf^{''}(\xi_i) \right)=
    \frac{h^3}{3}N
  f''(\xi)=
    \\
    &
    \frac{h^3}{3} \frac{(b-a)}{2h} f''(\xi)
  =\frac{(b-a)h^2}{6} f''(\xi).
  \end{align*}

  Así obtenemos la expresión definitiva para la \textbf{fórmula compuesta del
  punto medio}:
  \begin{equation*}
    \int_a^b f(x)\,dx
    = 2h \sum_{i=1}^{N} f_{2i-1} + \frac{(b-a)h^2}{6} f''(\xi).
  \end{equation*}
\end{example}


\subsection*{Expresión del error en fórmulas compuestas}
A continuación, estudiaremos con más detalle el error de cuadratura en
el intervalo global $[a,b]$ y comprobaremos que, haciendo que
$H\to 0$, podemos conseguir que el error global tienda cero.


Siendo el error de cuadratura, en una fórmula compuesta, la diferencia
entre la integral $\int_a^b f(x)\,dx$ y su aproximación $I_N(f)$, es
fácil ver que este error coincide con la suma de los errores en los
$N$ subintervalos $[\ox_{i-1},\ox_i]$:
\begin{alignat*}{2}
  E_N(f)&= \int_a^b f(x)\,dx - I_N(f)
  &\quad \text{(definición del error de integración)}
  \\
  &= \sum_{i=1}^N \int_{\ox_{i-1}}^{\ox_i} f(x)\,dx -
  \sum_{i=1}^NI_n^i(f)
  &\text{(definición de una f.c.\ compuesta)}
  \\
  &= \sum_{i=1}^N\left(
    \int_{\ox_{i-1}}^{\ox_i} f(x)\,dx -  I_n^i(f) \right)
  =\sum_{i=1}^N E_n^i(f),
\end{alignat*}
donde, el error en (el subintervalo $[\ox_{i-1},\ox_i]$) es:
\begin{equation}
  \label{eq:fc.compuesta.error.subintervalos}
  E_n^{(i)}(f)=\int_{\ox_{i-1}}^{\ox_i} f(x)\,dx -  I_n^{(i)}(f).
\end{equation}

Si acotamos los errores $E_n^i(f)$ utilizando la cota genérica del
error de cuadratura~(\ref{eq:cota-error-fcti}), podemos obtener una
primera estimación del error de cuadratura $E_N(f)$ (esta tarea se
deja como ejercicio).

Pero en el caso habitual estaremos utilizando fórmulas de N--C en cada
subintervalo, es decir con nodos equiespaciados, y por tanto nos
encontraremos con una situación más favorable, pues podemos
identificar los errores $E_n^i(f)$ usando el
teorema~\ref{thm:error.formulas-nc} y en concreto la
expresión~(\ref{eq:error-formulas-nc}). Así obtenemos el siguiente
resultado:

\begin{theorem}
  \label{thm:error.fc.comp-nc}
  Sea $I_N$ una f.c.\ compuesta sobre una partición uniforme
  $a=\ox_0<\ox_1<\dots<\ox_N=b$. Supongamos que $I_N$ está definida por una
  fórmula de N--C de $n+1$ puntos en cada subintervalo
  $[\ox_{i-1},\ox_i]$.  Si $f\in C^k([a,b])$, donde $k=n+2$ si $n$ es par
  y $k=n+1$ si $n$ es impar, entonces existe $\xi\in(a,b)$ tal que:
  \begin{equation}
    \label{eq:error.fc.comp-nc}
    E_N(f)= \int_a^bf(x)\,dx - I_N(f)
    = C_n \, (b-a) \, H^{k} \, f^{k)}(\xi),
  \end{equation}
  donde $H=(b-a)/N$ y $C_n$ es una constante universal (independiente
  de $f$ y del intervalo $[a,b]$). En concreto:
  \begin{equation*}
  C_n=\left\{
    \begin{array}{cl}
      \displaystyle\frac{\gamma_n}{n^k\,k!} & \quad \text{ si la fórmula de N--C es
        cerrada},
      \\ \noalign{\medskip}
      \displaystyle\displaystyle\frac{\gamma_n}{(n+2)^k\,k!} &\quad \text{ si la fórmula
        de N-C es abierta},
    \end{array}
  \right.
\end{equation*}
  donde $\gamma_n$ son las constantes definidas en el
  teorema~\ref{thm:error.formulas-nc}.
\end{theorem}

\begin{proof}~
  Hemos visto que $E_n(f)=\sum_{i=1}^N E_n^i(f)$.
  Si utilizamos la expresión~(\ref{eq:error-formulas-nc}) para el
  error $E_n^i(f)$ en el intervalo $[\ox_{i-1},\ox_i]$ llegamos
  literalmente a:
  \begin{equation}
    E_N(f)=\sum_{i=1}^N E_n^i(f) =\sum_{i=1}^N \gamma_n
    h^{k+1} \frac{f^{k)}(\xi_i)}{k!}
    = \gamma_n \frac{h^{k+1}}{k!} \sum_{i=1}^Nf^{k)}(\xi_i),
    \label{eq:fc.1}
  \end{equation}
  donde $\gamma_n$, $h$ y $k$ vienen dados en el
  teorema~\ref{thm:error.formulas-nc} y $\xi_i\in(\ox_{i-1},\ox_i)$.

  Procediendo de forma similar al
  ejemplo~\ref{ex:fc.compuesta.ptomedio}, es fácil ver que
  \begin{equation}
    \label{eq:fc.7}
    \text{$\exists \xi\in(a,b)$ tal que }
    \frac 1N \sum_{i=1}^Nf^{k)}(\xi_i) = f^{k)}(\xi).
  \end{equation}
  En efecto, $f\in C^k([a,b])$, $f^{k)}$ es continua en $[a,b]$ por lo que
  alcanza todos los valores entre su mínimo, $m_k$, y su máximo, $M_k$.
  % Sean
  % $m_k=\min_{x\in[a,b]} f^{k)}(x)$ y $M_k=\max_{x\in[a,b]} f^{k)}(x)$.
  Como para todo $\xi_i$ se tiene que $m_k\le f^{k)}(\xi_i)\le M_k$, tenemos que
  $$
  m_k \le \frac 1N \sum_{i=1}^Nf^{k)}(\xi_i) \le M_k,
  $$
  luego se verifica~(\ref{eq:fc.7}). Finalmente,
  aplicando~(\ref{eq:fc.7}) a~(\ref{eq:fc.1}) y usando que, por
  definición de $H$, $N=(b-a)/H$:
  \begin{equation}
    \label{eq:3}
    E_N(f) = \gamma_n \frac{h^{k+1}}{k!} N f^{k)}(\xi)
    =   \gamma_n \frac{h^{k+1}}{k!}\; \frac{b-a}{H} \,  f^{k)}(\xi).
  \end{equation}

  Para terminar, en función
  del tipo de fórmula de N-C usada en los subintervalos
  $[\ox_{i-1},\ox_i]$, es fácil relacionar $h$ con $H$. En concreto:
  \begin{align*}
    \intertext{\quad $\bullet$ Si la f.c.\ N--C es \emph{cerrada}:
      $h=(\ox_i-\ox_{i-1})/n=H/n$. Sustituyendo en~(\ref{eq:3}):}
    E_N(f) &= \gamma_n \, (b-a)\, \frac{H^{k}}{n^k\,k!} \,
    f^{k)}(\xi).
    \intertext{\quad $\bullet$ Si la
      f.c.\ N--C es \emph{abierta}: $
      h=(\ox_i-\ox_{i-1})/(n+2)=H/(n+2)$ luego}
    E_N(f) &= \gamma_n
    \, (b-a) \, \frac{H^{k}}{(n+2)^k\,k!} \, f^{k)}(\xi).
  \end{align*}
  En cualquiera de los dos casos, si definimos $C_n$ como se
  indica en el enunciado del teorema, llegamos a~(\ref{eq:error.fc.comp-nc}).
\end{proof}

\begin{remark}
  Algunas consideraciones sobre el teorema anterior:
  \begin{enumerate}
  \item Puesto que los parámetros $h$ y $H$ son proporcionales
    ($h=H/n$ o $h=H/(n+2)$, en función de si las f.c.\ locales son
    cerradas o abiertas), habría sido equivalente escribir el
    error~(\ref{eq:error.fc.comp-nc}) en función de $h$:
    \begin{equation}
      \label{eq:error.fc.comp-nc.bis}
      E_N(f)= \int_a^bf(x)\,dx - I_N(f)
      = \widetilde C_n \, (b-a) \, h^{k} \, f^{k)}(\xi),
    \end{equation}
    donde las constantes $\widetilde C_n$ son constantes universales
    muy fáciles de expresar en función de las constantes $C_n$ del
    Teorema~\ref{thm:error.fc.comp-nc} (ejercicio).
  \item La expresión del error~(\ref{eq:error.fc.comp-nc}) nos
    indica que
    \begin{equation*}
      |E_n(f)| \le C_n (b-a) H^k \|f^{k)}\|_{\infty,a,b},
    \end{equation*}
    lo que garantiza la convergencia de $I_N(f)$ hacia
    $\int_a^b f(x)\, dx$ cuando $H\to 0$ (o, equivalentemente, cuando
    $N \to\infty$).
  \item Más aún, la cota anterior nos indica cuál es exactamente la
    velocidad de convergencia en una f.c.\ compuesta (definida por una
    fórmula de N-C):
    \begin{equation*}
      E_N(f)=O(H^{k}), \quad \text{cuando } H\to 0,
    \end{equation*}
    donde, donde $O(H^m)$ se define en~(\ref{eq:def.O(hm)}) y, si la
    fórmula de N-C es elegida inteligentemente ($n$ par), $k=n+2$.

    Obsérvese que el error en una fórmula compuesta se rebaja un orden
    respecto a~(\ref{eq:error-formulas-nc}) (asimilando $H = h$, salvo
    constante), por acumulación de los errores locales (cometidos en
    los subintervalos).
  \end{enumerate}
\end{remark}

\begin{example} [Fórmula compuesta de Simpson]
  Consideramos ahora la fórmula compuesta definida, en cada
  subintervalo, $[\ox_{i},\ox_{i+1}]$, con $i=0,\dots,N-1$, como
   \begin{equation*}
    \int_{\ox_{i}}^{\ox_{i+1}} f(x)\, dx \approx I_1(f)=
    \frac{\ox_{i+1}-\ox_{i}}{6} \, \left[f(\ox_i) +
      4f\left(\frac{\ox_{i}+\ox_{i+1}}{2}\right)+f(\ox_{i+1})\right].
  \end{equation*}
  Como ejercicio se puede comprobar que (procediendo como en el
  ejemplo anterior) se obtiene la siguiente expresión para la fórmula
  compuesta de Simpson:
  \begin{equation*}
    \int_a^b f(x)\,dx
    = \frac{h}{3} \left[
      f_0
      + 2\sum_{i=1}^{N-1} f_{2i}
      + 4\sum_{i=1}^{N} f_{2i-1}
      + f_{2N} \right]
    + \frac{(b-a)h^4}{180} f^{4)}(\xi).
  \end{equation*}
\end{example}

\section{Fórmulas de cuadratura de Gauss}
\label{sec:fc-Gauss}
Sea una fórmula de cuadratura $I_n(f)=\sum_{i=0}^n \omega_i f(x_i)$
sobre $n+1$ nodos $\{x_i\}\in [a,b]$ que han sido \textit{previamente
  fijados}. En la sección~\ref{sec:cuadratura-interpolatorio} (en
concreto, en la Proposición~\ref{pro:existencia.fcti}) hemos visto que
podemos elegir $n+1$ pesos $\omega_i$ adecuados (de hecho,
$\omega_i=\int_a^b L_i(x)\, dx$, de forma que la f.c.\ sea de tipo
interpolatorio) para que la fórmula de cuadratura asociada tenga orden
máximo, en concreto orden $\ge n$.

En la secciones~\ref{sec:formulas-de-newton}
y~\ref{sec:fc-compuestas}, dedicadas respectivamente a las f.c.\ de
Newton-Côtes y a las f.c.\ compuestas, nos hemos limitado a escoger
nodos equiespaciados (la elección más sencilla) pero sin que exista
ningún tipo de garantía de que ésta sea la elección óptima. En esta
sección nos preguntaremos si es posible \textit{elegir los nodos de manera
adecuada} para que el orden de la f.c.\ sea el mayor posible. En
concreto, planteamos el siguiente problema:
\begin{equation}
\label{eq:pb.fc.Gauss}
\tag{P}
\left.
  \begin{aligned}
    &\text{Elegir el soporte $S=\{x_0<x_1<\dots<x_n\}\subset [a,b]$}
    \\
    &\text{tal que la f.c.t.i.\ asociada sea de orden máximo.}
  \end{aligned}
\right\}
\end{equation}

\begin{definition}
  Las fórmulas de cuadratura (de tipo interpolatorio) con nodos
  obtenidos como solución del problema~(\ref{eq:pb.fc.Gauss}) reciben
  el nombre de fórmulas de cuadratura de Gauss.
\end{definition}
\subsection*{Aproximación heurística}
Para resolver el problema anterior, intentemos razonar como en la
demostración de la proposición~\ref{pro:existencia.fcti} (en la que se
determinaron de forma óptima los coeficientes $\omega_i$ como solución
de un sistema lineal de ecuaciones con matriz de Vandermonde).


Una f.c.\ dada, $I_n(f)=\sum_{i=0}^n \omega_i f(x_i)$, tiene orden
$m\in\Nset$ si y solo si $E(x^{m+1})\neq 0$ y se verifican las
siguientes $m+1$ ecuaciones:
\begin{alignat*}{2}
  E_n(x^0)&=\int_a^b x^0\, dx -I_n(x^0)&\; =0, \\
  E_n(x^1)&=\int_a^b x^1\, dx -I_n(x^1)&\; =0, \\
  % E_n(x^2)&=\int_a^b x^2\, dx -I_n(x^2)&\; =0, \\
  &~\quad\vdots \\
  E_n(x^m)&=\int_a^b x^m\, dx -I_n(x^m)&\; =0.
\end{alignat*}
En esta ocasión, en la f.c.\ podemos escoger libremente los $n+1$ nodos
$\{x_i\}_{i=0}^n$ y los $n+1$ pesos, $\{\omega_i\}_{i=0}^n$. En total
tenemos a nuestra disposición $2n+2$ incógnitas, por tanto, para que
el sistema de ecuaciones anterior tenga matriz cuadrada, deberá estar
formado por $2n+2$ ecuaciones, es decir, debe ser $m=2n+1$.

Esto significa que podemos aspirar a que las fórmulas de cuadratura de
Gauss tengan orden $2n+1$. Los nodos y los pesos se pueden obtener
resolviendo un sistema de ecuaciones. El inconveniente es que, en este
caso, se trata de un sistema de ecuaciones no lineales por lo que,
salvo en casos sencillos, no será posible probar la existencia y
unicidad de solución ni recurrir una estrategia simple para calcular
los nodos de integración.


\begin{example}
  Dado el intervalo $[a,b]=[-1,1]$, buscamos dos puntos
  $x_0,x_1\in [a,b]$, $x_0\neq x_1$, y dos pesos $\omega_i\in\Rset$
  tales que la f.c.\ asociada sea de orden máximo, $2n+1=3$. Para
  ello, imponemos que esta f.c.\ sea exacta para los polinomios $x^i$,
  $i=0,\dots,3$:
  \begin{alignat*}{3}
    E_n(x^0)&=\int_{-1}^1 x^0\, dx - I_n(x^0)\ =\ 0 \ \Leftrightarrow
    \quad & 2 &= \omega_0+\omega_1,\\
    E_n(x^1)&=\int_{-1}^1 x^1\, dx - I_n(x^1)\ =\ 0 \ \Leftrightarrow
    \quad & 0 &=  \omega_0x_0+\omega_1x_1,\\
    E_n(x^2)&=\int_{-1}^1 x^2\, dx - I_n(x^2)\ =\ 0 \ \Leftrightarrow
    \quad & \frac{2}{3} &= \omega_0x_0^2+\omega_1x_1^2,\\
    E_n(x^3)&=\int_{-1}^1 x^3\, dx - I_n(x^3)\ =\ 0 \ \Leftrightarrow
    \quad &0 &=
    \omega_0x_0^3+\omega_1x_1^3.
  \end{alignat*}
  De la segunda y la cuarta ecuaciones deducimos que $x_0^2=x_1^2$.  Y
  teniendo en cuenta la primera ecuación (como $x_0<x_1$) debe ser
  $x_0=-1/{\sqrt 3}$, $x_1={\sqrt 3}$. Entonces, es fácil llegar a
  $w_0=w_1=1$ (por ejemplo, usando las dos primeras ecuaciones).

  Por lo tanto, la fórmula de cuadratura de Gauss con dos puntos en el
  intervalo $[-1,1]$ (de orden $2n+1=3$) se puede expresar de la
  siguiente forma:
  \begin{equation*}
    \int_{-1}^1 f(x)\, dx \approx f\Big( \frac{-1}{\sqrt 3} \Big)
    + f\Big(\frac{1}{\sqrt 3}\Big).
  \end{equation*}
\end{example}

\subsection*{Polinomios ortogonales}
Para obtener los nodos asociados a fórmulas de cuadratura de Gauss, en
vez de la resolución de los sistemas no lineales descritos
anteriormente, se utiliza la estrategia que se describe a
continuación, basada en la identificación de los nodos de integración
con las raíces de unas familias de polinomios conocidos como
polinomios ortogonales.

Debido a las características de esta asignatura no podemos entrar en
detalles. Nos limitamos a recapitular los resultados fundamentales
sobre existencia y unicidad de fórmulas de cuadratura de Gauss, así
como de caracterización de los nodos de cuadratura.

% \begin{definition}[Espacio $L^2(a,b)$]
%   Dado un intervalo $[a,b]\subset\Rset$, definimos
%   $$
%   L^2(a,b) = \big\{ f:[a,b] \to \Rset \text{ medibles }
%   \ /\ \int_a^b |f(x)|^2 dx < +\infty \big\}.
%   $$
% \end{definition}


% \begin{proposition}[Cauchy-Schwartz]
%   Sean $f,g \in L^2([a,b])$. Entonces el producto $fg$ es integrable y
%   $$
%   \int_a^b f(x)g(x) dx \le \big(\int_a^b |f(x)|^2
%   dx\big)^{1/2}\big(\int_a^b |g(x)|^2 dx\big)^{1/2}.
%   $$
% \end{proposition}

\begin{definition}
  \label{def:pol-orgotonales}
  Consideremos el espacio vectorial $\Pol_n[x]$, formado por los
  polinomios de grado menor o igual que $n$.

  \begin{enumerate}
  \item Dos polinomios, $p,q\in\Pol_n[x]$, se dicen ortogonales (en
    $L^2(a,b)$) si
      \begin{equation*}
      (p,q)_{L^2(a,b)} := \int_a^b p(x)q(x) dx = 0.
    \end{equation*}
  \item Una base $\{\phi_0,\phi_1,\dots,\phi_n\}$ de $\Pol_n[x]$ se
    dice ortogonal en $L^2(a,b)$ si todos sus elementos son ortogonales
    dos a dos, es decir
    \begin{equation*}
      (\phi_i,\phi_j)_{L^2(a,b)} = \int_a^b \phi_i(x) \phi_j(x)\, dx = 0 \quad \text{si } i\neq j.
    \end{equation*}
  \item
    Una base se dice ortonormal cuando es ortogonal y además los
    polinomios son unitarios, en el siguiente sentido:
    \begin{equation*}
      \|\phi_i\|_{L^2(a,b)} := \left(\int_a^b (\phi_i(x))^2 \,dx\right)^{1/2} = 1.
    \end{equation*}
  \end{enumerate}
\end{definition}

\begin{proposition}~ Para todo $n$, existe alguna base ortonormal
  $\{\phi_0,\phi_1,\dots,\phi_n\}$ de $\Pol_n[x]$ donde el grado de
  cada $\phi_k$ es igual a $k$ ($k=0,\dots,n$).
\end{proposition}

\begin{proposition}
  Sea $\{\phi_0,\phi_1,\dots,\phi_n\}$ una base ortonormal de
  $\Pol_n[x]$ tal que el grado de cada $\phi_k$ es igual a $k$
  ($k=0,\dots,n$).  Entonces cada polinomio $\phi_k$ tiene exactamente
  $k$ raíces reales \emph{simples} en $(a,b)$.
\end{proposition}

\begin{theorem}~
  \begin{enumerate}
  \item En un intervalo $[a,b]$ existe una única f.c.t.i.\ de orden $(2n+1)$.
  \item Esta fórmula está dada por:
    \begin{enumerate}
    \item El soporte $S=\{x_0<x_1<\dots<x_n\}$ formado por las $n+1$
      raíces del $(n+1)$--ésimo polinomio de una base
      ortonormal de $\Pol_{n+1}[x]$.
    \item Los pesos, dados por $\omega_i=\int_a^b L_i(x)\, dx$, que son
      todos positivos.
    \end{enumerate}
  \end{enumerate}
\end{theorem}

Para la demostración de los resultados anteriores, véase el libro de
[Guillén-Dubova] en bibliografía.
La construcción de fórmulas de cuadratura de Gauss se basa en la
teoría anterior. En concreto, dado un intervalo $[a,b]$ y dado $n\in\Nset$:
\begin{enumerate}
\item Construir una base ortonormal,
  $\{\phi_0,\phi_1,\dots,\phi_{n+1}\}$, de $\Pol_{n+1}[x]$.
\item Hallar las $n+1$ raíces, $x_0,\dots,x_n$, de $\phi_{n+1}$.
\item Calcular los $n+1$ pesos $\omega_0,\dots,\omega_n$ para que la
  fórmula sea de tipo interpolatorio.
\end{enumerate}
Esto nos garantiza que fórmula resultante
$I_n(f)=\sum_{i=0}^n w_i f(x_i)$ es de Gauss y por tanto que su orden
es $2n+1$.

Lo anterior tiene un inconveniente: la construcción de bases
ortonormales en intervalos arbitrarios $[a,b]$ y el posterior cálculo
de sus raíces es un proceso complicado. Por ello, se suele evitar el
cálculo de f.c.\ de Gauss en intervalos arbitrarios. En su lugar, se
utilizan intervalos de referencia, por ejemplo $[-1,1]$ o $[0,1]$, en
las que los polinomios ortogonales han sido ampliamente estudiados y
cuyos ceros (así como los pesos asociados) han sido ya calculados y
tabulados. Dada una f.c.\ en un intervalo de referencia, por ejemplo
$[-1,1]$, podemos calcular la integral en cualquier otro intervalo,
$[a,b]$, mediante un simple cambio de variables.

% % % \begin{proposition}
% % %   Dadas dos bases ortogonales de $\Pol_n[k]$,
% % %   $\{\phi_0,\phi_1,\dots,\phi_n\}$ y
% % %   $\{\overline\phi_0,\overline\phi_1,\dots,\overline\phi_n\}$ los
% % %   polinomios de cada una de estas bases son proporcionales, es decir,
% % %   para cada $i=0,\dotsn$ existe $\alpha_i$ tal que
% % %   \begin{equation*}
% % %     \phi_i = \alpha_i ,\overline\phi_i.
% % %   \end{equation*}
% % %   En particular, $\phi_i$ y $\overline\phi_i$ tienen los mismos
% % %   ceros.
% % % \end{proposition}

% % \begin{theorem}
% %   Existe una única f.c.t.i. de orden $(2n+1)$. Esta fórmula se
% %   corresponde con el soporte $S=\{x_0<x_1<\dots<x_n\}$ formado por las
% %   $n+1$ raíces de $\phi_{n+1}$, el $n$--ésimo polinomio ortogonal en
% %   $(a,b)$. Además, los pesos $\omega_i=\int_a^b L_i(x)\, dx$ son todos
% %   positivos.
% % \end{theorem}


\begin{EjerciciosPropuestos}
  \begin{problema}
    Deducir la fórmula compuesta de los trapecios, así como su
    expresión del error. Utilizando esta fórmula, calcular una
    aproximación de la integral
    $$
    \int_0^1 \log(1+x^2)\, dx
    $$
    en la que podamos garantizar que el error de cuadratura es menor que
    $\varepsilon=0.001$. ¿En cuántos subintervalos hay que dividir el
    intervalo $[0,1]$?
  \item Se considera la fórmula de cuadratura
    \begin{equation}
      \label{eq:4}
      \int_0^1 f(x)\,dx \approx c_0 f(0) + c_1 f\bigg(\frac{1}{3}\bigg)
      + c_2 f\bigg(\frac{2}{3}\bigg) + c_3 f(1).
    \end{equation}
    \begin{itemize}
    \item Calcular los coeficientes $c_0$, $c_1$, $c_2$ y $c_3$ para
      los que esta fórmula es exacta para polinomios de grado menor o
      igual que $3$. Comprobar que la fórmula resultante no
      proporcionan el valor exacto para polinomios de orden $4$.
    \item Aplicar esta fórmula de cuadratura para aproximar la
      siguiente integral:
      \begin{equation*}
        \int_0^1 \big(-\log(\cos x) \big)\,dx
      \end{equation*}
    \item Realizar el cambio de variables $t=(x-a)/(b-a)$ para
      transformar la integral
      \begin{equation*}
        \int_a^b f(x)\, dx
      \end{equation*}
      en una integral sobre el intervalo $[0,1]$. Usar este cambio
      para extender la fórmula de cuadratura~(\ref{eq:4})
       cualquier intervalo $[a,b]$.
     \item Sabiendo que la regla anterior es la fórmula de cuadratura
       de Newton-Côtes cerrada con $4$ nodos, obtener una expresión
       extendida que de la fórmula compuesta correspondiente,
       incluyendo un término de error.
    \item Aplicar la fórmula compuesta con $20$ subintervalos para
      aproximar la siguiente integral:
      \begin{equation*}
        \int_0^{10} \log\big(1+3e^{-x^2}\big)\,dx.
      \end{equation*}
    \end{itemize}
  \end{problema}

  \begin{problema}
  Determinar las constantes $A_0$, $A_1$ y $A_2$ de modo que la
  fórmula de cuadratura
  \begin{equation*}
    \int_0^h f(x)\,dx = h \bigg\{
    A_0f(0) + A_1f\bigg(\frac{h}{3}\bigg) + A_2 f(h) \bigg\}
  \end{equation*}
  sea exacta para polinomios del mayor grado posible. Utilizarla para
  aproximar la integral
  \begin{equation*}
    \int_0^{1/2} e^{-x^2}\, dx.
  \end{equation*}
  \end{problema}

  \begin{problema}
    Determinar los coeficientes $\alpha_0$, $\alpha_1$,  $\beta_0$ y
    $\beta_1$ para los que la fórmula de cuadratura
    \begin{equation*}
      \int_a^b f(x)\, dx \approx \alpha_0 f(a) + \alpha_1 f(b)
      + \beta_0 f'(a) + \beta_1 f'(b)
    \end{equation*}
    tiene el mayor orden posible. ¿Cuál es este orden de precisión?.
    Sabiendo que el error puede escribirse como
    \begin{equation*}
      \gamma (b-a)^5 f^{4)}(\xi),
    \end{equation*}
    para algún $\xi\in(a,b)$, determinar el valor de $\gamma$.
  \end{problema}

  \begin{problema}
    Para calcular un valor aproximado de $\ln 2$, se utilizará el
    hecho de que la integral
    \begin{equation*}
      \int_1^2 \frac{1}{x}\, dx
    \end{equation*}
    concide con este valor. Averiguar el número de subintervalos
    necesarios para que, al usar la fórmula compuesta de Simpson, el
    error sea inferior a $10^{-3}$. Utilizando el ordenador, calcular
    una aproximación de $\log 2$ y comprobar el error.
  \end{problema}

  \begin{problema}
    Se considera la fórmula de cuadratura
    \begin{equation*}
      \int_0^1 f(x)\, dx \approx A (f(x_0) + f(x_1)).
    \end{equation*}
    \begin{enumerate}
    \item Hallar el valor de $A$, $x_0$ y $x_1$ para que la
      fórmula sea exacta para polinomios del mayor grado
      posible. ¿Cuál es éste?
    \item Comprobar, mediante el cambio de variables $t=2x-1$, que
      la fórmula de cuadratura coincide con la regla de Gauss con
      dos nodos:
      \begin{equation*}
        \int_{-1}^1 g(x)\,dx \approx g\bigg(\frac{-1}{\sqrt
          3}\bigg) + g\bigg(\frac{1}{\sqrt 3}\bigg).
      \end{equation*}
    \end{enumerate}
  \end{problema}

  \begin{problema}
    La regla de Lobatto es una fórmula de cuadratura gaussiana
    definida en $[-1,1]$ de la siguiente forma:
    \begin{equation*}
      \int_{-1}^1 f(x)\, dx = A_0 f(-1) + \sum_{i=1}^{n-1} A_if(x_i) +
      A_nf(1).
    \end{equation*}
    \begin{itemize}
    \item Detallar la expresión de la regla de Lobatto para
      $n=3$. ¿Cuál es el orden de precisión de esta regla?
    \item Realizando un cambio de variable adecuado, utilizar la regla
      de Lobatto (con $n=3$) para estimar
      \begin{equation*}
        \int_1^2 e^x\, dx.
      \end{equation*}
    \end{itemize}
  \end{problema}
\end{EjerciciosPropuestos}

\end{document}

% % =============== =======

% \begin{problemas}
%   \begin{problema}
%     Demostrar que la función $f(x)=x^2e^{x}-1$ tiene un único
%     cero. Utilizar el método de bisección para aproximarlo con un
%     error menor que $\varepsilon=10^{-7}$. Comparar el resultado con
%     la solución aproximada que proporciona la función \texttt{fsolve}
%     (contenida en el paquete \texttt{optimize} de \textit{Scipy}).
%   \end{problema}
%   \begin{problema}
%     Utilizar el método de bisección para aproximar las raíces de las
%     siguientes ecuaciones con una tolerancia menor que
%     $\varepsilon=10^{-8}$.
%     \begin{enumerate}
%     \item $e^x-3x^2=0$.
%     \item $x^3=x^2+x+1$.
%     \end{enumerate}
%   \end{problema}
%  \begin{problema}
%     Consideremos el siguiente producto infinito para el cálculo de $\pi$:
%     (publicado en 1593 por François Viète y conocido como fórmula de Viète):
%     \begin{equation*}
%       \frac{2}{\pi}  = \prod_{k\to\infty} \frac{a_k}2, \qquad\text{donde }\quad
%       a_0 = \sqrt{2}, \quad a_{k+1} = \sqrt{2+a_k}.
%     \end{equation*}

%     \begin{enumerate}
%     \item Calcular las $15$ primeras aproximaciones de $\pi$ para la
%       fórmula de Viète (correspondientes a la evaluación del producto
%       anterior para $k=0,\dots,14$) y sus errores absolutos, $e_k$.
%     \item Mostrar en una tabla los logaritmos de los errores, $\log
%       e_k$, y los cocientes $\log e_{k+1}/\log
%       e_{k}$ (con $k\ge 0$).
%     \item Justificar la siguiente afirmación y utilizarla para estimar
%       el orden de la fórmula de Viète:
%       \begin{equation*}
%         \label{eq:1}
%         \{x_k\} \text{ es un método iterativo de orden } p
%         \Leftrightarrow \lim_{k\to\infty} \frac{\log e_{k+1}}{\log e_{k}}=p.
%       \end{equation*}
%     \end{enumerate}
%   \end{problema}
%   \begin{problema}
%     Consideremos el problema de punto fijo $x=g(x)$, con
%     $g(x)=1/(2+x)$.  Probar que existe una única solución en el
%     intervalo $[0,1]$ y que método de aproximaciones sucesivas
%     $x_{k+1}=g(x_k)$ converge hacia una solución para cualquier
%     inicialización, $x_0\in[0,1]$. Aproximar la
%     solución con un error menor que $\varepsilon=10^{-8}$.
%   \end{problema}
%   \begin{problema}
%     Dada la ecuación $f(x)=e^x-(x+1)^2=0$:
%     \begin{itemize}
%     \item Estudiar sus raíces reales
%     \item Localizarlas en intervalos en los que el método de Newton
%       esté bien definido y sea convergente (idea: en cada intervalo,
%       aplicar la regla de Fourier)
%     \item En cada uno de estos intervalos, calcular una aproximación
%       de la raíz de forma que el error con la solución exacta sea
%       menor que $10^{-6}$.
%     \end{itemize}
%   \end{problema}
%   \begin{problema}
%     Calcular mediante el método de Newton las raices de
%     $$f(x)=2\sqrt{x}-\frac{x^3+5}{5}$$ en $[0.1,1]$ realizando
%     iteraciones hasta que la diferencia en dos etapas consecutivas sea
%     menor que $10^{-10}$. ¿Converge el método si partes del punto
%     medio del intervalo? Justifícalo geométricamente. ¿Y desde los
%     extremos? Justifícalo mediante la Regla de Fourier.
%   \end{problema}
%   \begin{problema}
%     Dada la ecuación $f(x)=e^x-(x-2)^2=0$:
%     \begin{itemize}
%     \item Justificar geométricamente que sólo posee una raíz real
%     \item Demostrarlo analíticamente. Idea: probar que $f'(x)>0$ para
%       todo $x\in\Rset$. Para ello, cuando $x>2$, aplicar a $e^x$ el
%       teorema del valor medio en $[2,x]$ para probar que $e^x>2(x-2)$.
%     \end{itemize}
%   \end{problema}
%   \begin{problema}
%     Calcular las tres primeras aproximaciones ($k=0,1,2$) de $\pi$
%     mediante el algoritmo de Gauss-Legendre (o de Brent-Salamin):
%     $a_0=1$, $b_0=1/\sqrt 2$, $t_0=1/4$, $p_0=1$,
%     \begin{align*}
%       a_{k+1}&=(a_{k}+b_{k})/2 , &\quad
%       t_{k+1}&=t_k - p_k(a_k -a_{k+1})^2, \\
%       b_{k+1}& =\sqrt{a_{k}\*b_{k}}, &\quad p_{k+1}&=2p_k.
%     \end{align*}
%     $$
%     \pi = \lim_{k\to\infty} \frac{(a_k+b_k)^2}{4t_k}.
%     $$
%     Utilizando los logaritmos de los errores absolutos, estimar el
%     orden del algoritmo.
%   \end{problema}
%   \begin{problema}
%     Consideremos el método de bisección para
%     una función $f$ en el intervalo $[a,b]=[2.6,4.2]$.
%     \begin{enumerate}
%     \item ¿Cuál es la longitud del subintervalo en el paso $k$--ésimo?
%     \item ¿Cuál es la máxima distancia entre la raíz, $\alpha$, de $f$
%       y el punto medio del intervalo en ese paso $k$--ésimo?
%     \item ¿Cuántas iteraciones son necesarias, como mínimo, para que
%       la longitud del intervalo sea menor que $\varepsilon=10^{-5}$?
%     \end{enumerate}
%   \end{problema}
% \end{problemas}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../tema3.tex"
%%% End:
